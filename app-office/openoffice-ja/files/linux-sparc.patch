Index: boost/boost_1_27_0.patch
===================================================================
RCS file: /cvs/external/boost/boost_1_27_0.patch,v
retrieving revision 1.4.10.1
diff -u -u -r1.4.10.1 boost_1_27_0.patch
--- boost/boost_1_27_0.patch	15 Aug 2003 11:47:26 -0000	1.4.10.1
+++ boost/boost_1_27_0.patch	10 Mar 2004 05:42:33 -0000
@@ -31,7 +31,26 @@
 + #if defined(BOOST_OOO_NO_NEW_EXCEPTIONS) && !defined(BOOST_NO_EXCEPTIONS)
 + #define BOOST_NO_EXCEPTIONS
 + #endif
-+ 
++
+*** misc/boost_1_27_0/boost/detail/atomic_count.hpp	Fri Feb  8 02:26:13 2002
+--- misc/build/boost_1_27_0/boost/detail/atomic_count.hpp	Fri Dec 19 01:00:46 2003
+***************
+*** 93,99 ****
+
+  #include <boost/detail/atomic_count_win32.hpp>
+
+! #elif defined(linux) || defined(__linux) || defined(__linux__)
+
+  #include <boost/detail/atomic_count_linux.hpp>
+
+--- 93,99 ----
+
+  #include <boost/detail/atomic_count_win32.hpp>
+
+! #elif (defined(linux) || defined(__linux) || defined(__linux__)) && !(defined(SPARC) || defined(sparc) || defined(sparc64))
+
+  #include <boost/detail/atomic_count_linux.hpp>
+  
 *** misc/boost_1_27_0/boost/detail/atomic_count_linux.hpp	Thu Feb  7 10:26:13 2002
 --- misc/build/boost_1_27_0/boost/detail/atomic_count_linux.hpp	Wed May  7 11:28:19 2003
 ***************
@@ -157,7 +176,7 @@
 --- misc/build/boost_1_27_0/boost/detail/linux_atomic.h	Wed May  7 11:32:48 2003
 ***************
 *** 0 ****
---- 1,181 ----
+--- 1,118 ----
 + #ifndef _LINUX_ATOMIC_H_
 + #define _LINUX_ATOMIC_H_
 + 
@@ -268,70 +287,7 @@
 +	__CS_LOOP(old_val, new_val, v, 1, "sr");
 +        return new_val;
 +}
-+#elif defined ( SPARC )
-+
-+
-+#define atomic_set(v, i)	(((v)->aVal) = ((i) << 8))
-+
-+static __inline__ int __atomic_add(int i, atomic_t *v)
-+{
-+	register volatile int *ptr asm("g1");
-+	register int increment asm("g2");
-+
-+	ptr = &v->aVal;
-+	increment = i;
-+
-+	__asm__ __volatile__(
-+	"mov	%%o7, %%g4\n\t"
-+	"call	___atomic_add\n\t"
-+	" add	%%o7, 8, %%o7\n"
-+	: "=&r" (increment)
-+	: "0" (increment), "r" (ptr)
-+	: "g3", "g4", "g7", "memory", "cc");
-+
-+	return increment;
-+}
 +
-+static __inline__ int __atomic_sub(int i, atomic_t *v)
-+{
-+	register volatile int *ptr asm("g1");
-+	register int increment asm("g2");
-+
-+	ptr = &v->aVal;
-+	increment = i;
-+
-+	__asm__ __volatile__(
-+	"mov	%%o7, %%g4\n\t"
-+	"call	___atomic_sub\n\t"
-+	" add	%%o7, 8, %%o7\n"
-+	: "=&r" (increment)
-+	: "0" (increment), "r" (ptr)
-+	: "g3", "g4", "g7", "memory", "cc");
-+
-+	return increment;
-+}
-+
-+#define atomic_add(i, v) ((void)__atomic_add((i), (v)))
-+#define atomic_sub(i, v) ((void)__atomic_sub((i), (v)))
-+
-+#define atomic_dec_return(v) __atomic_sub(1, (v))
-+#define atomic_inc_return(v) __atomic_add(1, (v))
-+
-+#define atomic_sub_and_test(i, v) (__atomic_sub((i), (v)) == 0)
-+#define atomic_dec_and_test(v) (__atomic_sub(1, (v)) == 0)
-+
-+#define atomic_inc(v) ((void)__atomic_add(1, (v)))
-+#define atomic_dec(v) ((void)__atomic_sub(1, (v)))
-+
-+#define atomic_add_negative(i, v) (__atomic_add((i), (v)) < 0)
-+
-+/* Atomic operations are already serializing */
-+#define smp_mb__before_atomic_dec()	barrier()
-+#define smp_mb__after_atomic_dec()	barrier()
-+#define smp_mb__before_atomic_inc()	barrier()
-+#define smp_mb__after_atomic_inc()	barrier()
-+ 
-+#endif
 + #else
 + 
 + #error - need to define your processors atomic inc and dec here
Index: boost/makefile.mk
===================================================================
RCS file: /cvs/external/boost/makefile.mk,v
retrieving revision 1.4
diff -u -u -r1.4 makefile.mk
--- boost/makefile.mk	2 Jul 2003 15:23:23 -0000	1.4
+++ boost/makefile.mk	10 Mar 2004 05:42:33 -0000
@@ -76,7 +76,7 @@
 
 PATCH_FILE_NAME=boost_1_27_0.patch
 
-#ADDITIONAL_FILES=
+ADDITIONAL_FILES=boost$/detail$/linux_atomic.h
 
 CONFIGURE_DIR=
 CONFIGURE_ACTION=
Index: bridges/source/cpp_uno/gcc3_linux_sparc/cpp2uno.cxx
===================================================================
RCS file: /cvs/udk/bridges/source/cpp_uno/gcc3_linux_sparc/cpp2uno.cxx,v
retrieving revision 1.2
diff -u -u -r1.2 cpp2uno.cxx
--- bridges/source/cpp_uno/gcc3_linux_sparc/cpp2uno.cxx	28 Apr 2003 16:28:42 -0000	1.2
+++ bridges/source/cpp_uno/gcc3_linux_sparc/cpp2uno.cxx	10 Mar 2004 05:42:33 -0000
@@ -163,8 +163,21 @@
 			{
 			case typelib_TypeClass_HYPER:
 			case typelib_TypeClass_UNSIGNED_HYPER:
-			case typelib_TypeClass_DOUBLE:
-				pCppStack += sizeof(sal_Int32); // extra long
+            		case typelib_TypeClass_DOUBLE:
+            		{
+			if ((reinterpret_cast< long >(pCppStack) & 7) != 0)
+              		{
+		   		OSL_ASSERT( sizeof (double) == sizeof (sal_Int64) );
+                   		void * pDest = alloca( sizeof (sal_Int64) );
+                  	 	*reinterpret_cast< sal_Int32 * >(pDest) =
+                   		*reinterpret_cast< sal_Int32 const * >(pCppStack);
+                   		*(reinterpret_cast< sal_Int32 * >(pDest) + 1) =
+                   		*(reinterpret_cast< sal_Int32 const * >(pCppStack) + 1);
+                   		pCppArgs[nPos] = pUnoArgs[nPos] = pDest;
+			}
+		   	pCppStack += sizeof (sal_Int32); // extra long
+                   	break;
+			}
 			}
 			// no longer needed
 			TYPELIB_DANGER_RELEASE( pParamTypeDescr );
@@ -488,7 +501,7 @@
 	sal_Bool bComplex = nTableEntry & 0x80000000 ? sal_True : sal_False;
 
 	typelib_TypeClass aType =
-		cpp_mediate( nTableEntry, pCallStack+17, &nRegReturn );
+		cpp_mediate( nTableEntry, pCallStack+17, (sal_Int64*)&nRegReturn );
 
 	switch( aType )
 	{
Index: bridges/source/cpp_uno/gcc3_linux_sparc/uno2cpp.cxx
===================================================================
RCS file: /cvs/udk/bridges/source/cpp_uno/gcc3_linux_sparc/uno2cpp.cxx,v
retrieving revision 1.2.34.1
diff -u -u -r1.2.34.1 uno2cpp.cxx
--- bridges/source/cpp_uno/gcc3_linux_sparc/uno2cpp.cxx	15 Aug 2003 11:59:42 -0000	1.2.34.1
+++ bridges/source/cpp_uno/gcc3_linux_sparc/uno2cpp.cxx	10 Mar 2004 05:42:39 -0000
@@ -359,16 +359,24 @@
 		if (!rParam.bOut && cppu_isSimpleType( pParamTypeDescr ))
 		{
 			pCppArgs[ nPos ] = adjustPointer( pCppStack, pParamTypeDescr );
-			uno_copyAndConvertData( pCppArgs[nPos], pUnoArgs[nPos], pParamTypeDescr,
-									&pThis->pBridge->aUno2Cpp );
-			
 			switch (pParamTypeDescr->eTypeClass)
 			{
 			case typelib_TypeClass_HYPER:
 			case typelib_TypeClass_UNSIGNED_HYPER:
 			case typelib_TypeClass_DOUBLE:
-				pCppStack += sizeof(sal_Int32); // extra long
-			}
+                        OSL_ASSERT( sizeof (double) == sizeof (sal_Int64) );
+                          *reinterpret_cast< sal_Int32 * >(pCppStack) =
+                          *reinterpret_cast< sal_Int32 const * >(pUnoArgs[ nPos ]);
+                          pCppStack += sizeof (sal_Int32);
+                          *reinterpret_cast< sal_Int32 * >(pCppStack) =
+                          *(reinterpret_cast< sal_Int32 const * >(pUnoArgs[ nPos ] ) + 1);
+                          break;
+            		default:
+                          uno_copyAndConvertData(
+                             pCppArgs[nPos], pUnoArgs[nPos], pParamTypeDescr,
+                             &pThis->pBridge->aUno2Cpp );
+                          break;
+                        }
 			// no longer needed
 			TYPELIB_DANGER_RELEASE( pParamTypeDescr );
 		}
@@ -407,11 +415,15 @@
 
 	try
 	{
+		int nStackLongs = (pCppStack - pCppStackStart)/sizeof(sal_Int32);
 		OSL_ENSURE( !( (pCppStack - pCppStackStart ) & 3), "UNALIGNED STACK !!! (Please DO panic" );
 		callVirtualMethod(
-			pThis->pCppI, nVtableCall,
-			pCppReturn, pReturnTypeDescr->eTypeClass,
-			(sal_Int32 *)pCppStackStart, (pCppStack - pCppStackStart) / sizeof(sal_Int32) );
+			pThis->pCppI,
+			nVtableCall,
+			pCppReturn,
+			pReturnTypeDescr->eTypeClass,
+			(sal_Int32 *)pCppStackStart,
+			 nStackLongs);
 		// NO exception occured...
 		*ppUnoExc = 0;
 		
Index: cppu/source/uno/copy.hxx
===================================================================
RCS file: /cvs/udk/cppu/source/uno/copy.hxx,v
retrieving revision 1.10
diff -u -u -r1.10 copy.hxx
--- cppu/source/uno/copy.hxx	20 Mar 2003 12:28:50 -0000	1.10
+++ cppu/source/uno/copy.hxx	10 Mar 2004 05:42:40 -0000
@@ -752,12 +752,7 @@
 		break;
 	case typelib_TypeClass_HYPER:
 	case typelib_TypeClass_UNSIGNED_HYPER:
-#if defined(GCC) && defined(SPARC)
-		*(sal_Int32 *)pDest = *(sal_Int32 *)pSource;
-		*(((sal_Int32 *)pDest) +1) = *(((sal_Int32 *)pSource) +1);
-#else
 		*(sal_Int64 *)pDest = *(sal_Int64 *)pSource;
-#endif
 		break;
 	case typelib_TypeClass_FLOAT:
 		*(float *)pDest = *(float *)pSource;
Index: scp/source/office/files.scp
===================================================================
RCS file: /cvs/installation/scp/source/office/Attic/files.scp,v
retrieving revision 1.369.16.9
diff -u -u -r1.369.16.9 files.scp
--- scp/source/office/files.scp	10 Feb 2004 20:05:45 -0000	1.369.16.9
+++ scp/source/office/files.scp	10 Mar 2004 05:44:58 -0000
@@ -3301,6 +3301,26 @@
 
 #endif
 
+
+#if defined (FAT_PRODUCT) && defined(LINUX) && defined(SPARC)
+
+Custom GID_CUSTOM_JVM
+    FileName = LIBNAME(jvm);
+    Styles = (EXEC_INST_BEFORE,STANDALONE,WORKSTATION,NETWORK,REPAIRABLE);
+	Code		= {
+        [Install]
+        InstallationPath=.
+        RequiredVersion=1.4.1_01
+        ExcludeVersion=
+        AdditionalClasspath=<OFFICE_CLASSDIR>/classes.jar:<OFFICE_CLASSDIR>/sandbox.jar:<OFFICE_CLASSDIR>/ridl.jar:<OFFICE_CLASSDIR>/unoil.jar:<OFFICE_CLASSDIR>/jurt.jar:<OFFICE_CLASSDIR>/juh.jar:<OFFICE_CLASSDIR>/java_uno.jar:<OFFICE_CLASSDIR>/xt.jar:<OFFICE_CLASSDIR>/jaxp.jar:<OFFICE_CLASSDIR>/java_uno_accessbridge.jar:<OFFICE_CLASSDIR>/aportisdoc.jar:<OFFICE_CLASSDIR>/htmlsoff.jar:<OFFICE_CLASSDIR>/jmc.jar:<OFFICE_CLASSDIR>/minicalc.jar:<OFFICE_CLASSDIR>/pexcel.jar:<OFFICE_CLASSDIR>/pocketword.jar:<OFFICE_CLASSDIR>/XFlatXml.jar:<OFFICE_CLASSDIR>/xmerge.jar:<OFFICE_CLASSDIR>/XMergeBridge.jar:
+		AdditionalJars=javaplugin.jar;plugin.jar
+        CPLD=0
+    };
+End
+
+#endif
+
+
 #endif
                                   // of #ifdef SOLAR_JAVA
 
? a.out
? solar.c.stripped
? test.c
? x
Index: solar.c
===================================================================
RCS file: /cvs/util/tools/source/solar/solar.c,v
retrieving revision 1.2
diff -u -r1.2 solar.c
--- solar.c	15 Apr 2003 17:55:43 -0000	1.2
+++ tools/source/solar/solar.c	22 Oct 2003 13:08:21 -0000
@@ -58,17 +58,22 @@
  *
  *
  ************************************************************************/
-#include <stdio.h>
 
-#ifdef UNX
+/* POSIX defines that a program is undefined after a SIG_SEGV.  The
+ * code stopped working on Linux Kernel 2.6 so I have moved this back to
+ * use FORK.
+ * If at a later time the signals work correctly with the Linux Kernel 2.6
+ * then this change may be reverted although not strictly posix safe. */
+#define USE_FORK_TO_CHECK 1
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <errno.h>
+#include <string.h>
 
 #include <unistd.h>
 #include <sys/types.h>
 
-#ifdef HPUX
-#include <stdlib.h>
-#endif
-
 #define I_STDARG
 #ifdef I_STDARG
 #include <stdarg.h>
@@ -84,9 +89,6 @@
 #include <setjmp.h>
 #endif
 
-#else
-#endif
-
 #define printTypeSize(Type,Name)	printf(	"sizeof(%s)\t= %d\n", Name, sizeof (Type) )
 
 #define isSignedType(Type)	(((Type)-1) < 0)
@@ -133,7 +135,7 @@
 
 /*************************************************************************
 |*
-|*	IsStackGrowingDown()
+|*	GetStackAlignment()
 |*
 |*	Beschreibung		Alignment von char Parametern, die (hoffentlich)
 |*						ueber den Stack uebergeben werden
@@ -176,8 +178,6 @@
 typedef int (*TestFunc)( Type, void* );
 
 
-#ifdef UNX
-
 /*************************************************************************
 |*
 |*	PrintArgs()
@@ -230,11 +230,11 @@
 void SignalHdl( int sig )
 {
   bSignal = 1;
-  /*
+  
   fprintf( stderr, "Signal %d caught\n", sig );
-  signal( sig,	SignalHdl );
-  /**/
-  longjmp( check_env, sig );
+  signal( SIGSEGV,	SIG_DFL );
+  signal( SIGBUS,	SIG_DFL );
+  siglongjmp( check_env, sig );
 }
 #endif
 
@@ -270,7 +270,7 @@
 
   bSignal = 0;
 
-  if ( !setjmp( check_env ) )
+  if ( !sigsetjmp( check_env, 0 ) )
   {
 	signal( SIGSEGV,	SignalHdl );
 	signal( SIGBUS,		SignalHdl );
@@ -286,9 +286,6 @@
 #endif
 }
 
-#endif
-
-
 /*************************************************************************
 |*
 |*	GetAtAddress()
@@ -373,6 +370,7 @@
 int CheckSetAccess( Type eT, void* p )
 {
   int b;
+
   b = -1 != check( (TestFunc)SetAtAddress, eT, p );
 #if OSL_DEBUG_LEVEL > 1
   fprintf( stderr,
@@ -437,7 +435,7 @@
 |*	Letzte Aenderung
 |*
 *************************************************************************/
-Description_Ctor( struct Description* pThis )
+void Description_Ctor( struct Description* pThis )
 {
   pThis->bBigEndian			= IsBigEndian();
   pThis->bStackGrowsDown	= IsStackGrowingDown();
@@ -468,16 +466,21 @@
 |*	Letzte Aenderung
 |*
 *************************************************************************/
-Description_Print( struct Description* pThis, char* name )
+void Description_Print( struct Description* pThis, char* name )
 {
   int i;
   FILE* f = fopen( name, "w" );
+  if( ! f ) {
+	  fprintf( stderr, "Unable to open file %s: %s\n", name, strerror( errno ) );
+	  exit( 99 );
+  }
   fprintf( f, "#define __%s\n",
 		   pThis->bBigEndian ? "BIGENDIAN" : "LITTLEENDIAN" );
   for ( i = 0; i < 3; i++ )
 	fprintf( f, "#define __ALIGNMENT%d\t%d\n",
-			 1 << i+1, pThis->nAlignment[i] );
-  fprintf( f, "#define __STACKALIGNMENT wird nicht benutzt\t%d\n", pThis->nStackAlignment );
+			 1 << (i+1), pThis->nAlignment[i] );
+  fprintf( f, "/* Stack alignment is not used... */\n" );
+  fprintf( f, "#define __STACKALIGNMENT\t%d\n", pThis->nStackAlignment );
   fprintf( f, "#define __STACKDIRECTION\t%d\n",
 		   pThis->bStackGrowsDown ? -1 : 1 );
   fprintf( f, "#define __SIZEOFCHAR\t%d\n", sizeof( char ) );
@@ -538,8 +541,12 @@
 	printf( ( CheckGetAccess( eT, (long*)&a[i] ) ? "OK\n" : "ERROR\n" ) );
   }
 }
-
-main( int argc, char* argv[] )
+/************************************************************************
+ *
+ * 	Use C code to determine the characteristics of the building platform.
+ *
+ ************************************************************************/
+int main( int argc, char* argv[] )
 {
   printTypeSign( char, "char" );
   printTypeSign( short, "short" );
@@ -574,7 +581,6 @@
 	Description_Ctor( &description );
 	Description_Print( &description, argv[1] );
   }
-
   {
 	char* p = NULL;
 	InfoMemoryAccess( p );
